<div class="admin-products">
  <div class="header">
    <h1>ูุฏุฑุช ูุญุตููุงุช</h1>
    <button class="btn-primary" (click)="openAddModal()">
      โ ุงูุฒูุฏู ูุญุตูู ุฌุฏุฏ
    </button>
  </div>

  <div class="search-box">
    <input
      type="text"
      [(ngModel)]="searchQuery"
      (input)="onSearch()"
      placeholder="ุฌุณุชุฌู ูุญุตูู..."
      class="search-input"
    />
  </div>

  @if (isLoading()) {
    <div class="loading">ุฏุฑ ุญุงู ุจุงุฑฺฏุฐุงุฑ...</div>
  } @else {
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>ุดูุงุณู</th>
            <th>ูุงู ูุญุตูู</th>
            <th>ุฏุณุชูโุจูุฏ</th>
            <th>ููุช</th>
            <th>ููุฌูุฏ</th>
            <th>ูุถุนุช</th>
            <th>ุนููุงุช</th>
          </tr>
        </thead>
        <tbody>
          @for (product of products(); track product.id) {
            <tr>
              <td>{{ product.id }}</td>
              <td>{{ product.name }}</td>
              <td>{{ product.categoryName }}</td>
              <td>{{ product.price | number }} ุชููุงู</td>
              <td>{{ product.stock }}</td>
              <td>
                <span class="badge" [class.active]="product.isActive">
                  {{ product.isActive ? 'ูุนุงู' : 'ุบุฑูุนุงู' }}
                </span>
              </td>
              <td class="actions">
                <button class="btn-edit" (click)="openEditModal(product)">โ๏ธ</button>
                <button class="btn-delete" (click)="deleteProduct(product.id)">๐๏ธ</button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="7" class="no-data">ูุญุตูู ุงูุช ูุดุฏ</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    @if (totalPages() > 1) {
      <div class="pagination">
        <button [disabled]="currentPage() === 1" (click)="changePage(currentPage() - 1)">ูุจู</button>
        <span>ุตูุญู {{ currentPage() }} ุงุฒ {{ totalPages() }}</span>
        <button [disabled]="currentPage() === totalPages()" (click)="changePage(currentPage() + 1)">ุจุนุฏ</button>
      </div>
    }
  }
</div>

<!-- Modal -->
@if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingProduct() ? 'ูุฑุงุด ูุญุตูู' : 'ุงูุฒูุฏู ูุญุตูู ุฌุฏุฏ' }}</h2>
        <button class="close-btn" (click)="closeModal()">โ</button>
      </div>

      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <div class="form-group">
            <label>ูุงู ูุญุตูู *</label>
            <input type="text" formControlName="name" />
          </div>

          <div class="form-group">
            <label>SKU *</label>
            <input type="text" formControlName="sku" />
          </div>
        </div>

        <div class="form-group">
          <label>ุฏุณุชูโุจูุฏ *</label>
          <select formControlName="categoryId">
            <option [value]="null">ุงูุชุฎุงุจ ุฏุณุชูโุจูุฏ</option>
            @for (category of categories(); track category.id) {
              <option [value]="category.id">{{ category.name }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label>ุชูุถุญุงุช ฺฉูุชุงู</label>
          <input type="text" formControlName="shortDescription" />
        </div>

        <div class="form-group">
          <label>ุชูุถุญุงุช ฺฉุงูู *</label>
          <textarea formControlName="description" rows="4"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>ููุช (ุชููุงู) *</label>
            <input type="number" formControlName="price" />
          </div>

          <div class="form-group">
            <label>ููุช ุชุฎูู (ุชููุงู)</label>
            <input type="number" formControlName="discountPrice" />
          </div>

          <div class="form-group">
            <label>ููุฌูุฏ *</label>
            <input type="number" formControlName="stock" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group checkbox">
            <label>
              <input type="checkbox" formControlName="isActive" />
              <span>ูุนุงู</span>
            </label>
          </div>

          <div class="form-group checkbox">
            <label>
              <input type="checkbox" formControlName="isFeatured" />
              <span>ูฺู</span>
            </label>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">ุงูุตุฑุงู</button>
          <button type="submit" class="btn-submit" [disabled]="productForm.invalid">
            {{ editingProduct() ? 'ุฐุฎุฑู ุชุบุฑุงุช' : 'ุงูุฒูุฏู ูุญุตูู' }}
          </button>
        </div>
      </form>
    </div>
  </div>
}
